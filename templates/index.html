{% extends "base.html" %}

{% block title %}Code Sender - Env√≠o de C√≥digos{% endblock %}

{% block content %}
<h1>Code Sender</h1>
<p>
    Env√≠a c√≥digos √∫nicos y an√≥nimos a una lista de correos electr√≥nicos
</p>

<form method="POST">
    <div class="field">
        <label class="label">API Key de SendGrid</label>
        <div class="control is-flex is-align-items-center">
            <input class="input" type="password" name="api_key" id="api-key" placeholder="Ingresa tu API Key de SendGrid">
            <button class="button is-small ml-2" id="toggle-password" type="button" title="Mostrar/ocultar">üôâ</button>
        </div>
        <small style="color: #666; margin-left: 10px;">Tu API Key se usa solo para este env√≠o y no se almacena.</small>
    </div>

    <div class="field">
        <label class="label">Lista de Correos Electr√≥nicos:</label>
        <div class="control pb-4">
            <input class="input email-field" type="input" placeholder="usuario@ejemplo.com">
        </div>

        <button class="button is-dark is-fullwidth" id="add-email">‚ûï Agregar otro correo</button>
    </div>
    
    <button class="button is-primary is-large is-fullwidth" type="submit">Enviar c√≥digos</button>
</form>

<script>
    const addEmailButton = document.getElementById('add-email');
    const togglePasswordButton = document.getElementById('toggle-password');
    const apiKeyInput = document.getElementById('api-key');
    const emailFields = document.getElementsByClassName('email-field');

    addEmailButton.addEventListener('click', e => {
        e.preventDefault();
        addEmailField();
    });

    togglePasswordButton.addEventListener('click', () => {
        if (apiKeyInput.type === 'password') {
            apiKeyInput.type = 'text';
            togglePasswordButton.textContent = 'üôà';
        } else {
            apiKeyInput.type = 'password';
            togglePasswordButton.textContent = 'üôâ';
        }
    });

    function addEmailField() {
        const newDiv = document.createElement('div');
        newDiv.className = 'control pb-4 is-flex is-align-items-center';
        const newInput = document.createElement('input');
        newInput.className = 'input email-field';
        newInput.type = 'email';
        newInput.placeholder = 'usuario@ejemplo.com';
        const deleteButton = document.createElement('button');
        deleteButton.className = 'button is-small ml-2';
        deleteButton.textContent = '‚ûñ';
        deleteButton.type = 'button';
        deleteButton.title = 'Remover este correo';
        deleteButton.addEventListener('click', () => newDiv.remove());
        newDiv.appendChild(newInput);
        newDiv.appendChild(deleteButton);
        addEmailButton.parentNode.insertBefore(newDiv, addEmailButton);
    }

    function gatherEmails() {
        const emails = [];
        for (let field of emailFields) {
            if (field.value.trim()) {
                emails.push(field.value.trim());
            }
        }
        return emails;
    }
</script>
{% endblock %}